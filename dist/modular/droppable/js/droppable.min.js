"undefined"==typeof gj&&(gj={}),gj.widget=function(){var a=this;a.xhr=null,a.generateGUID=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}},gj.widget.prototype.init=function(a,b){var c,d=this.getConfig(a,b);this.attr("data-guid",d.guid),this.attr("data-"+b,"true"),this.data(d);for(c in d)gj[b].events.hasOwnProperty(c)&&(this.on(c,d[c]),delete d[c]);for(plugin in gj[b].plugins)gj[b].plugins.hasOwnProperty(plugin)&&gj[b].plugins[plugin].configure(this,d);return this},gj.widget.prototype.getConfig=function(a,b){var c,d,e,f;c=$.extend(!0,{},gj[b].config.base),d=$.extend(!0,{},this.getHTMLConfig()||{}),$.extend(!0,d,a||{}),e=d.uiLibrary||c.uiLibrary,gj[b].config[e]&&$.extend(!0,c,gj[b].config[e]);for(f in gj[b].plugins)gj[b].plugins.hasOwnProperty(f)&&(gj[b].plugins[f].config.base&&$.extend(!0,c,gj[b].plugins[f].config.base),gj[b].plugins[f].config[e]&&$.extend(!0,c,gj[b].plugins[f].config[e]));return $.extend(!0,c,d),c.guid||(c.guid=this.generateGUID()),c},gj.widget.prototype.getHTMLConfig=function(){var a=this.data(),b=this[0].attributes;return b.width&&(a.width=b.width.nodeValue),b.height&&(a.height=b.height.nodeValue),a&&a.source&&(a.dataSource=a.source,delete a.source),a},gj.widget.prototype.render=function(a){},gj.widget.prototype.createDoneHandler=function(){var a=this;return function(b){a.render(b)}},gj.widget.prototype.reload=function(a){var b,c=this.data();return $.extend(c.params,a),$.isArray(c.dataSource)?this.render(c.dataSource):"string"==typeof c.dataSource?(b={url:c.dataSource,data:c.params,success:this.createDoneHandler()},this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b)):"object"==typeof c.dataSource&&(c.dataSource.data||(c.dataSource.data={}),$.extend(c.dataSource.data,c.params),b=$.extend(!0,{},c.dataSource),"json"===b.dataType&&"object"==typeof b.data&&(b.data=JSON.stringify(b.data)),b.success||(b.success=this.createDoneHandler()),this.xhr&&this.xhr.abort(),this.xhr=$.ajax(b)),this},gj.documentManager={events:{},subscribeForEvent:function(a,b,c){if(gj.documentManager.events[a]&&0!==gj.documentManager.events[a].length){if(gj.documentManager.events[a][b])throw"Event "+a+" for widget with guid='"+b+"' is already attached.";gj.documentManager.events[a].push({widgetId:b,callback:c})}else gj.documentManager.events[a]=[{widgetId:b,callback:c}],$(document).on(a,gj.documentManager.executeCallbacks)},executeCallbacks:function(a){var b=gj.documentManager.events[a.type];if(b)for(var c=0;c<b.length;c++)b[c].callback(a)},unsubscribeForEvent:function(a,b){var c=!1,d=gj.documentManager.events[a];if(d)for(var e=0;e<d.length;e++)d[e].widgetId===b&&(d.splice(e,1),c=!0,0===d.length&&($(document).off(a),delete gj.documentManager.events[a]));if(!c)throw'The "'+a+'" for widget with guid="'+b+"\" can't be removed."}},"undefined"==typeof gj.droppable&&(gj.droppable={}),gj.droppable.config={hoverClass:void 0},gj.droppable.methods={init:function(a){var b=this;return gj.widget.prototype.init.call(this,a,"droppable"),gj.documentManager.subscribeForEvent("mousedown",b.data("guid"),gj.droppable.methods.createMouseDownHandler(b)),gj.documentManager.subscribeForEvent("mousemove",b.data("guid"),gj.droppable.methods.createMouseMoveHandler(b)),gj.documentManager.subscribeForEvent("mouseup",b.data("guid"),gj.droppable.methods.createMouseUpHandler(b)),b},createMouseDownHandler:function(a){return function(b){a.isDragging=!0}},createMouseMoveHandler:function(a){return function(b){if(a.isDragging){var c=a.data("hoverClass"),d=gj.droppable.methods.isOver(a,b);d!=a.isOver&&(d?(c&&a.addClass(c),gj.droppable.events.over(a)):(c&&a.removeClass(c),gj.droppable.events.out(a))),a.isOver=d}}},createMouseUpHandler:function(a){return function(b){a.isDragging=!1,gj.droppable.methods.isOver(a,b)&&gj.droppable.events.drop(a)}},isOver:function(a,b){var c=gj.droppable.methods.mouseX(b),d=gj.droppable.methods.mouseY(b),e=a.offset();return c>e.left&&c<e.left+a.width()&&d>e.top&&d<e.top+a.height()},mouseX:function(a){if(a){if(a.pageX)return a.pageX;if(a.clientX)return a.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft)}return null},mouseY:function(a){if(a){if(a.pageY)return a.pageY;if(a.clientY)return a.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)}return null},destroy:function(a){return"true"===a.attr("data-droppable")&&(gj.documentManager.unsubscribeForEvent("mousedown",a.data("guid")),gj.documentManager.unsubscribeForEvent("mousemove",a.data("guid")),gj.documentManager.unsubscribeForEvent("mouseup",a.data("guid")),a.removeData(),a.removeAttr("data-guid"),a.removeAttr("data-droppable"),a.off("drop").off("over").off("out")),a}},gj.droppable.events={drop:function(a,b,c){a.trigger("drop",[{top:c,left:b}])},over:function(a){a.trigger("over")},out:function(a){a.trigger("out")}},gj.droppable.widget=function(a,arguments){var b=this,c=gj.droppable.methods;return b.isOver=!1,b.isDragging=!1,b.destroy=function(){return c.destroy(this)},b.isOver=function(a){return c.isOver(this,a)},$.extend(a,b),"true"!==a.attr("data-droppable")&&c.init.apply(a,arguments),a},gj.droppable.widget.prototype=new gj.widget,gj.droppable.widget.constructor=gj.droppable.widget,function(a){a.fn.droppable=function(a){var b;if("object"!=typeof a&&a){if(b=new gj.droppable.widget(this,null),b[a])return b[a].apply(this,Array.prototype.slice.call(arguments,1));throw"Method "+a+" does not exist."}return new gj.droppable.widget(this,arguments)}}(jQuery);